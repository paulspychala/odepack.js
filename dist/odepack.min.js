!function(t,i){"object"==typeof exports&&"undefined"!=typeof module?i(exports):"function"==typeof define&&define.amd?define(["exports"],i):i((t=t||self).odepack={})}(this,(function(t){"use strict";function i(t,i,s,h,r,e){var n;switch(i){case 1:for(n=1;n<=t;n++)e[n]=s[1]*Math.abs(r[n])+h[1];break;case 2:for(n=1;n<=t;n++)e[n]=s[1]*Math.abs(r[n])+h[n];break;case 3:for(n=1;n<=t;n++)e[n]=s[n]*Math.abs(r[n])+h[1];break;case 4:for(n=1;n<=t;n++)e[n]=s[n]*Math.abs(r[n])+h[n]}}function s(t,i,s,h,r,e,n){let o,a,l,f,m;if(o=0,t<=0)return o;if(h!=n||h<1){for(a=1,l=1,h<0&&(a=(1-t)*h+1),n<0&&(l=(1-t)*n+1),f=1;f<=t;f++)o+=i[a+s]*r[l+e],a+=h,l+=n;return o}if(1==h){if(m=t%5,0!=m){for(f=1;f<=m;f++)o+=i[f+s]*r[f+e];if(t<5)return o}for(f=m+1;f<=t;f+=5)o=o+i[f+s]*r[f+e]+i[f+s+1]*r[f+e+1]+i[f+s+2]*r[f+e+2]+i[f+s+3]*r[f+e+3]+i[f+s+4]*r[f+e+4];return o}for(f=1;f<=t*h;f+=h)o+=i[f+s]*r[f+e];return o}function h(t,i,s,h,r,e,n,o){let a,l,f,m;if(!(t<0||0==i))if(r!=o||r<1)for(a=1,l=1,r<0&&(a=(1-t)*r+1),o<0&&(l=(1-t)*o+1),f=1;f<=t;f++)e[l+n]=e[l+n]+i*s[a+h],a+=r,l+=o;else if(1!=r)for(f=1;f<=t*r;f+=r)e[f+n]=i*s[f+h]+e[f+n];else{if(m=t%4,0!=m){for(f=1;f<=m;f++)e[f+n]=e[f+n]+i*s[f+h];if(t<4)return}for(f=m+1;f<=t;f+=4)e[f+n]=e[f+n]+i*s[f+h],e[f+n+1]=e[f+n+1]+i*s[f+h+1],e[f+n+2]=e[f+n+2]+i*s[f+h+2],e[f+n+3]=e[f+n+3]+i*s[f+h+3]}}function r(t,i,s,h){let r,e,n,o,a;if(a=0,t<=0)return a;if(a=1,t<=1||h<=0)return a;if(1!=h){for(r=Math.abs(i[1+s]),o=2,n=1+h;n<=t*h;n+=h)e=Math.abs(i[n+s]),e>r&&(a=o,r=e),o++;return a}for(r=Math.abs(i[1+s]),n=2;n<=t;n++)e=Math.abs(i[n+s]),e>r&&(a=n,r=e);return a}function e(t,i,s,h,r){let e,n;if(!(t<=0))if(1==r){if(e=t%5,0!=e){for(n=1;n<=e;n++)s[n+h]=i*s[n+h];if(t<5)return}for(n=e+1;n<=t;n+=5)s[n+h]=i*s[n+h],s[n+h+1]=i*s[n+h+1],s[n+h+2]=i*s[n+h+2],s[n+h+3]=i*s[n+h+3],s[n+h+4]=i*s[n+h+4]}else for(n=1;n<=t*r;n+=r)s[n+h]=i*s[n+h]}function n(t,i,s){let h,r;for(r=0,h=1;h<=t;h++)r=Math.max(r,Math.abs(i[h])*s[h]);return r}function o(t,i,s){let h,r,e,n,o,a,l,f,m,c,d,u,p,x=new Array(13);if(1!=t)for(x[1]=1,d=1,r=1;r<=5;r++){for(a=r,n=r+1,x[n]=0,h=r+1;h>=2;h--)x[h]=x[h-1]+a*x[h];for(x[1]*=a,h=1;h<=n;h++)i[r][h]=x[h]/x[2];i[r][2]=1,s[r][1]=d,s[r][2]=n/i[r][1],s[r][3]=(r+2)/i[r][1],d/=a}else for(i[1][1]=1,i[1][2]=1,s[1][1]=0,s[1][2]=2,s[2][1]=1,s[12][3]=0,x[1]=1,c=1,r=2;r<=12;r++){for(d=c,c/=r,e=r-1,l=e,n=r+1,x[r]=0,h=r;h>=2;h--)x[h]=x[h-1]+l*x[h];for(x[1]=l*x[1],f=x[1],p=x[1]/2,u=1,h=2;h<=r;h++)u=-u,f+=u*x[h]/h,p+=u*x[h]/(h+1);for(i[r][1]=f*d,i[r][2]=1,h=2;h<=r;h++)i[r][h+1]=d*x[h]/h;o=c*p,m=1/o,s[r][2]=m,r<12&&(s[n][1]=m*c/n),s[e][3]=m}}class a{constructor(){this.ETA=2220446049250313e-31,this.mord=[0,12,5],this.sqrteta=Math.sqrt(this.ETA),this.sm1=[0,.5,.575,.55,.45,.35,.25,.2,.15,.1,.075,.05,.025],this.illin=0,this.init=0,this.ntrep=0,this.ixpr=0,this.el=new Array(14),this.elco=this.create2dArray(13,14),this.tesco=this.create2dArray(13,4),this.cm1=new Array(13),this.cm2=new Array(6)}create2dArray(t,i){let s=new Array(t);for(let h=0;h<t;h++)s[h]=new Array(i);return s}terminate(t){return 5==this.illin?console.error("[lsoda] repeated occurrence of illegal input. run aborted.. apparent infinite loop\n"):(this.illin++,t=-3),t}terminate2(t,i){let s;for(this.yp1=this.yh[1],s=1;s<=this.n;s++)t[s]=this.yp1[s];return i=this.tn,this.illin=0,i}successreturn(t,i,s,h,r,e){this.yp1=this.yh[1];for(let i=1;i<=this.n;i++)t[i]=this.yp1[i];return i=this.tn,4!=s&&5!=s||h&&(i=r),2,this.illin=0,[i,2]}lsoda(t,s,h,r,e,o,a,l,f,m,c,d,u,p,x,y,M,b,w,g,k,q,A,$,v){let j,E,T,z,O,D,L,S,W,_,P,R,B,C,F,G,H,I,J,K,N;if(m<1||m>3)return console.error("[lsoda] illegal istate = %d\n",m),[r,this.terminate(m)];if(f<1||f>5)return console.error("[lsoda] illegal itask = %d\n",f),[r,this.terminate(m)];if(0==this.init&&(2==m||3==m))return console.error("[lsoda] istate > 1 but lsoda not initialized\n"),[r,this.terminate(m)];if(1==m&&(this.init=0,e==r))return this.ntrep++,this.ntrep<5||console.error("[lsoda] repeated calls with istate = 1 and tout = t. run aborted.. apparent infinite loop\n"),[r,m];if(1==m||3==m){if(this.ntrep=0,s<=0)return console.error(`[lsoda] neq = ${s} is less than 1`),[r,this.terminate(m)];if(3==m&&s>this.n)return console.error("[lsoda] istate = 3 and neq increased"),[r,this.terminate(m)];if(this.n=s,o<1||o>4)return console.error(`[lsoda] itol = ${o} illegal`),[r,this.terminate(m)];if(c<0||c>1)return console.error(`[lsoda] iopt = ${c} illegal`),[r,this.terminate(m)];if(3==u||u<1||u>5)return console.error(`[lsoda] jt = ${u} illegal`),[r,this.terminate(m)];if(this.jtyp=u,u>2){if(this.ml=p,this.mu=x,this.ml<0||this.ml>=this.n)return console.error(`[lsoda] ml = ${this.ml} not between 1 and neq.`),[r,this.terminate(m)];if(this.mu<0||this.mu>=this.n)return console.error(`[lsoda] mu = ${this.mu} not between 1 and neq.`),[r,this.terminate(m)]}if(0==c)this.ixpr=0,this.mxstep=500,this.mxhnil=10,this.hmxi=0,this.hmin=0,1==m&&(S=0,this.mxordn=this.mord[1],this.mxords=this.mord[2]);else{if(this.ixpr=y,this.ixpr<0||this.ixpr>1)return console.error(`[lsoda] ixpr = ${this.ixpr} is illegal`),[r,this.terminate(m)];if(this.mxstep=M,this.mxstep<0)return console.error("[lsoda] mxstep < 0\n"),[r,this.terminate(m)];if(0==this.mxstep&&(this.mxstep=500),this.mxhnil=b,this.mxhnil<0)return console.error("[lsoda] mxhnil < 0\n"),[r,this.terminate(m)];if(1==m){if(S=q,this.mxordn=w,this.mxordn<0)return console.error(`[lsoda] mxordn = ${this.mxordn} is less than 0`),[r,this.terminate(m)];if(0==this.mxordn&&(this.mxordn=100),this.mxordn=Math.min(this.mxordn,this.mord[1]),this.mxords=g,this.mxords<0)return console.error(`[lsoda] mxords = ${this.mxords} is less than 0`),[r,this.terminate(m)];if(0==this.mxords&&(this.mxords=100),this.mxords=Math.min(this.mxords,this.mord[2]),(e-r)*S<0)return console.error(`[lsoda] tout = ${e} behind t = ${r}. integration direction is given by ${S}`),[r,this.terminate(m)]}if(W=A,W<0)return console.error("[lsoda] hmax < 0.\n"),[r,this.terminate(m)];if(this.hmxi=0,W>0&&(this.hmxi=1/W),this.hmin=$,this.hmin<0)return console.error("[lsoda] hmin < 0.\n"),[r,this.terminate(m)]}}if(1==m){for(this.meth=1,this.nyh=this.n,T=1+Math.max(this.mxordn,this.mxords),this.yh=new Array(1+T),j=1;j<=T;j++)this.yh[j]=new Array(1+this.nyh);for(this.wm=new Array(1+this.nyh),j=1;j<=this.nyh;j++)this.wm[j]=new Array(1+this.nyh);this.ewt=new Array(1+this.nyh),this.savf=new Array(1+this.nyh),this.acor=new Array(1+this.nyh),this.ipvt=new Array(1+this.nyh)}if(1==m||3==m)for(R=a[1],O=l[1],j=1;j<=this.n;j++){if(o>=3&&(R=a[j]),2!=o&&4!=o||(O=l[j]),R<0)return console.error(`[lsoda] rtol = ${R} is less than 0.`),[r,this.terminate(m)];if(O<0)return console.error(`[lsoda] atol = ${O} is less than 0.`),[r,this.terminate(m)]}if(3==m&&(this.jstart=-1),1==m){if(this.tn=r,this.tsw=r,this.maxord=this.mxordn,4==f||5==f){if(B=k,(B-e)*(e-r)<0)return console.error("[lsoda] itask = 4 or 5 and tcrit behind tout\n"),[r,this.terminate(m)];0!=S&&(r+S-B)*S>0&&(S=B-r)}for(this.jstart=0,this.nhnil=0,this.nst=0,this.nje=0,this.nslast=0,this.hu=0,this.nqu=0,this.mused=0,this.miter=0,this.ccmax=.3,this.maxcor=3,this.msbp=20,this.mxncf=10,t(r,h,this.yh[2],v),this.nfe=1,this.yp1=this.yh[1],j=1;j<=this.n;j++)this.yp1[j]=h[j];for(this.nq=1,this.h=1,i(this.n,o,a,l,h,this.ewt),j=1;j<=this.n;j++){if(this.ewt[j]<=0)return console.error(`[lsoda] ewt[${j}] = ${this.ewt[j]} <= 0.`),[r=this.terminate2(h,r),m];this.ewt[j]=1/this.ewt[j]}if(0==S){if(C=Math.abs(e-r),N=Math.max(Math.abs(r),Math.abs(e)),C<2*this.ETA*N)return console.error("[lsoda] tout too close to t to start integration\n "),[r,this.terminate(m)];if(G=a[1],o>2)for(j=2;j<=this.n;j++)G=Math.max(G,a[j]);if(G<=0)for(O=l[1],j=1;j<=this.n;j++)2!=o&&4!=o||(O=l[j]),D=Math.abs(h[j]),0!=D&&(G=Math.max(G,O/D));G=Math.max(G,100*this.ETA),G=Math.min(G,.001),K=n(this.n,this.yh[2],this.ewt),K=1/(G*N*N)+G*K*K,S=1/Math.sqrt(K),S=Math.min(S,C),S*=e-r>=0?1:-1}for(P=Math.abs(S)*this.hmxi,P>1&&(S/=P),this.h=S,this.yp1=this.yh[2],j=1;j<=this.n;j++)this.yp1[j]*=S}if(2==m||3==m)switch(this.nslast=this.nst,f){case 1:if((this.tn-e)*this.h>=0)return E=this.intdy(e,0,h,E),0!=E?(console.error("[lsoda] trouble from intdy, itask = %d, tout = %g\n",f,e),[r,this.terminate(m)]):(r=e,m=2,this.illin=0,[r,m]);break;case 2:break;case 3:if(I=this.tn-this.hu*(1+100*this.ETA),(I-e)*this.h>0)return console.error("[lsoda] itask = %d and tout behind tcur - hu\n",f),[r,this.terminate(m)];if((this.tn-e)*this.h<0)break;return this.successreturn(h,r,f,z,B,m);case 4:if(B=k,(this.tn-B)*this.h>0)return console.error("[lsoda] itask = 4 or 5 and tcrit behind tcur\n"),[r,this.terminate(m)];if((B-e)*this.h<0)return console.error("[lsoda] itask = 4 or 5 and tcrit behind tout\n"),[r,this.terminate(m)];if((this.tn-e)*this.h>=0)return E=this.intdy(e,0,h,E),0!=E?(console.error("[lsoda] trouble from intdy, itask = %d, tout = %g\n",f,e),[r,this.terminate(m)]):(r=e,m=2,this.illin=0,[r,m]);case 5:if(5==f&&(B=k,(this.tn-B)*this.h>0))return console.error("[lsoda] itask = 4 or 5 and tcrit behind tcur\n"),[r,this.terminate(m)];if(_=Math.abs(this.tn)+Math.abs(this.h),z=Math.abs(this.tn-B)<=100*this.ETA*_,z)return r=B,this.successreturn(h,r,f,z,B,m);if(F=this.tn+this.h*(1+4*this.ETA),(F-B)*this.h<=0)break;this.h=(B-this.tn)*(1-4*this.ETA),2==m&&(this.jstart=-2)}for(;;){if(1!=m||0!=this.nst){if(this.nst-this.nslast>=this.mxstep)return console.error("[lsoda] %d steps taken before reaching tout\n",this.mxstep),m=-1,[r=this.terminate2(h,r),m];for(i(this.n,o,a,l,this.yh[1],this.ewt),j=1;j<=this.n;j++){if(this.ewt[j]<=0)return console.error("[lsoda] ewt[%d] = %g <= 0.\n",j,this.ewt[j]),m=-6,[r=this.terminate2(h,r),m];this.ewt[j]=1/this.ewt[j]}}if(H=this.ETA*n(this.n,this.yh[1],this.ewt),H>.01)return H*=200,0==this.nst?(console.error("lsoda -- at start of problem, too much accuracy\n"),console.error("         requested for precision of machine,\n"),console.error("         suggested scaling factor = %g\n",H),[r,this.terminate(m)]):(console.error("lsoda -- at t = %g, too much accuracy requested\n",r),console.error("         for precision of machine, suggested\n"),console.error("         scaling factor = %g\n",H),m=-2,[r=this.terminate2(h,r),m]);if(this.tn+this.h==this.tn&&(this.nhnil++,this.nhnil<=this.mxhnil&&(console.error("lsoda -- warning..internal t = %g and h = %g are\n",this.tn,this.h),console.error("         such that in the machine, t + h = t on the next step\n"),console.error("         solver will continue anyway.\n"),this.nhnil==this.mxhnil&&(console.error("lsoda -- above warning has been issued %d times,\n",this.nhnil),console.error("         it will not be issued again for this problem\n")))),this.stoda(s,h,t,d,v),0==this.kflag){if(this.init=1,this.meth!=this.mused&&(this.tsw=this.tn,this.maxord=this.mxordn,2==this.meth&&(this.maxord=this.mxords),this.jstart=-1,this.ixpr&&(2==this.meth&&console.error("[lsoda] a switch to the stiff method has occurred "),1==this.meth&&console.error("[lsoda] a switch to the nonstiff method has occurred"),console.error("at t = %g, tentative step size h = %g, step nst = %d\n",this.tn,this.h,this.nst))),1==f){if((this.tn-e)*this.h<0)continue;return E=this.intdy(e,0,h,E),r=e,m=2,this.illin=0,[r,m]}if(2==f)return this.successreturn(h,r,f,z,B,m);if(3==f){if((this.tn-e)*this.h>=0)return this.successreturn(h,r,f,z,B,m);continue}if(4==f){if((this.tn-e)*this.h>=0)return E=this.intdy(e,0,h,E),r=e,m=2,this.illin=0,[r,m];if(_=Math.abs(this.tn)+Math.abs(this.h),z=Math.abs(this.tn-B)<=100*this.ETA*_,z)return this.successreturn(h,r,f,z,B,m);if(F=this.tn+this.h*(1+4*this.ETA),(F-B)*this.h<=0)continue;this.h=(B-this.tn)*(1-4*this.ETA),this.jstart=-2;continue}if(5==f)return _=Math.abs(this.tn)+Math.abs(this.h),z=Math.abs(this.tn-B)<=100*this.ETA*_,this.successreturn(h,r,f,z,B,m)}if(-1==this.kflag||-2==this.kflag){for(console.error(`lsoda -- at t = ${this.tn} and step size h = ${this.h}, the`),-1==this.kflag&&(console.error("         error test failed repeatedly or"),console.error("         with abs(h) = hmin"),m=-4),-2==this.kflag&&(console.error("         corrector convergence failed repeatedly or\n"),console.error("         with abs(h) = hmin\n"),m=-5),L=0,this.imxer=1,j=1;j<=this.n;j++)J=Math.abs(this.acor[j])*this.ewt[j],L<J&&(L=J,this.imxer=j);return[r=this.terminate2(h,r),m]}}return[r,m]}stoda(t,i,s,h,r){let e,a,l,f,m,c,d,u,p,x,y,M,b,w,g,k,q,A;if(this.kflag=0,k=this.tn,d=0,this.ierpj=0,this.iersl=0,this.jcur=0,p=0,0==this.jstart){for(this.lmax=this.maxord+1,this.nq=1,this.l=2,this.ialth=2,this.rmax=1e4,this.rc=0,this.el0=1,this.crate=.7,this.hold=this.h,this.nslp=0,this.ipup=this.miter,this.icount=20,this.irflag=0,this.pdest=0,this.pdlast=0,this.ratio=5,o(2,this.elco,this.tesco),l=1;l<=5;l++)this.cm2[l]=this.tesco[l][2]*this.elco[l][l+1];for(o(1,this.elco,this.tesco),l=1;l<=12;l++)this.cm1[l]=this.tesco[l][2]*this.elco[l][l+1];this.resetcoeff()}for(-1==this.jstart&&(this.ipup=this.miter,this.lmax=this.maxord+1,1==this.ialth&&(this.ialth=2),this.meth!=this.mused&&(o(this.meth,this.elco,this.tesco),this.ialth=this.l,this.resetcoeff()),this.h!=this.hold&&(w=this.h/this.hold,this.h=this.hold,[w,q]=this.scaleh(w,q))),-2==this.jstart&&this.h!=this.hold&&(w=this.h/this.hold,this.h=this.hold,[w,q]=this.scaleh(w,q));;){for(;;){for(Math.abs(this.rc-1)>this.ccmax&&(this.ipup=this.miter),this.nst>=this.nslp+this.msbp&&(this.ipup=this.miter),this.tn+=this.h,m=this.nq;m>=1;m--)for(f=m;f<=this.nq;f++)for(this.yp1=this.yh[f],this.yp2=this.yh[f+1],l=1;l<=this.n;l++)this.yp1[l]+=this.yp2[l];if(A=n(this.n,this.yh[1],this.ewt),[e,u,p,k,d,w,c]=this.correction(t,i,s,e,A,u,p,k,d,w,c,h,r),0==e)break;if(1!=e){if(2==e)return this.kflag=-2,this.hold=this.h,void(this.jstart=1)}else w=Math.max(w,this.hmin/Math.abs(this.h)),[w,q]=this.scaleh(w,q)}if(this.jcur=0,0==c&&(x=u/this.tesco[this.nq][2]),c>0&&(x=n(this.n,this.acor,this.ewt)/this.tesco[this.nq][2]),x<=1){for(this.kflag=0,this.nst++,this.hu=this.h,this.nqu=this.nq,this.mused=this.meth,m=1;m<=this.l;m++)for(this.yp1=this.yh[m],b=this.el[m],l=1;l<=this.n;l++)this.yp1[l]+=b*this.acor[l];if(this.icount--,this.icount<0&&([q,w]=this.methodswitch(x,A,q,w),this.meth!=this.mused)){w=Math.max(w,this.hmin/Math.abs(this.h)),[w,q]=this.scaleh(w,q),this.rmax=10,this.endstoda();break}if(this.ialth--,0==this.ialth){if(g=0,this.l!=this.lmax){for(this.yp1=this.yh[this.lmax],l=1;l<=this.n;l++)this.savf[l]=this.acor[l]-this.yp1[l];y=n(this.n,this.savf,this.ewt)/this.tesco[this.nq][3],M=1/(this.l+1),g=1/(1.4*Math.pow(y,M)+14e-7)}if([g,q,w,a]=this.orderswitch(g,x,q,w,a),0==a){this.endstoda();break}if(1==a){w=Math.max(w,this.hmin/Math.abs(this.h)),[w,q]=this.scaleh(w,q),this.rmax=10,this.endstoda();break}if(2==a){this.resetcoeff(),w=Math.max(w,this.hmin/Math.abs(this.h)),[w,q]=this.scaleh(w,q),this.rmax=10,this.endstoda();break}}if(this.ialth>1||this.l==this.lmax){this.endstoda();break}for(this.yp1=this.yh[this.lmax],l=1;l<=this.n;l++)this.yp1[l]=this.acor[l];this.endstoda();break}for(this.kflag--,this.tn=k,m=this.nq;m>=1;m--)for(f=m;f<=this.nq;f++)for(this.yp1=this.yh[f],this.yp2=this.yh[f+1],l=1;l<=this.n;l++)this.yp1[l]-=this.yp2[l];if(this.rmax=2,Math.abs(this.h)<=1.00001*this.hmin){this.kflag=-1,this.hold=this.h,this.jstart=1;break}if(this.kflag>-3)g=0,[g,q,w,a]=this.orderswitch(g,x,q,w,a),1!=a&&0!=a||(0==a&&(w=Math.min(w,.2)),w=Math.max(w,this.hmin/Math.abs(this.h)),[w,q]=this.scaleh(w,q)),2==a&&(this.resetcoeff(),w=Math.max(w,this.hmin/Math.abs(this.h)),[w,q]=this.scaleh(w,q));else{if(-10==this.kflag){this.kflag=-1,this.hold=this.h,this.jstart=1;break}for(w=.1,w=Math.max(this.hmin/Math.abs(this.h),w),this.h*=w,this.yp1=this.yh[1],l=1;l<=this.n;l++)i[l]=this.yp1[l];for(s(this.tn,i,this.savf,r),this.nfe++,this.yp1=this.yh[2],l=1;l<=this.n;l++)this.yp1[l]=this.h*this.savf[l];this.ipup=this.miter,this.ialth=5,1!=this.nq&&(this.nq=1,this.l=2,this.resetcoeff())}}}intdy(t,i,s,h){let r,e,n,o,a,l,f,m,c;if(h=0,i<0||i>this.nq)return console.error("[intdy] k = %d illegal\n",i),h=-1;if(c=this.tn-this.hu-100*this.ETA*(this.tn+this.hu),(t-c)*(t-this.tn)>0)return console.error(`intdy -- t = ${t} illegal. t not in interval tcur - hu to tcur\n`),h=-2;for(m=(t-this.tn)/this.h,e=1,o=this.l-i;o<=this.nq;o++)e*=o;for(l=e,this.yp1=this.yh[this.l],r=1;r<=this.n;r++)s[r]=l*this.yp1[r];for(n=this.nq-1;n>=i;n--){for(a=n+1,e=1,o=a-i;o<=n;o++)e*=o;for(l=e,this.yp1=this.yh[a],r=1;r<=this.n;r++)s[r]=l*this.yp1[r]+m*s[r]}if(0==i)return h;for(f=Math.pow(this.h,-i),r=1;r<=this.n;r++)s[r]*=f;return h}scaleh(t,i){let s,h,r;for(t=Math.min(t,this.rmax),t/=Math.max(1,Math.abs(this.h)*this.hmxi*t),1==this.meth&&(this.irflag=0,t*(i=Math.max(Math.abs(this.h)*this.pdlast,1e-6))*1.00001>=this.sm1[this.nq]&&(t=this.sm1[this.nq]/i,this.irflag=1)),s=1,h=2;h<=this.l;h++)for(s*=t,this.yp1=this.yh[h],r=1;r<=this.n;r++)this.yp1[r]*=s;return this.h*=t,this.rc*=t,this.ialth=this.l,[t,i]}prja(t,i,s,o,a){let l,f,m,c,d,u,p,x;if(this.nje++,this.ierpj=0,this.jcur=1,d=this.h*this.el0,1==this.miter){for(l=1;l<=this.n;l++)for(m=1;m<=this.n;m++)this.wm[l][m]=0;for(o(this.tn,i,0,0,this.wm,a),l=1;l<=this.n;l++)for(m=1;m<=this.n;m++)this.wm[l][m]*=-d}else if(2==this.miter){for(c=n(this.n,this.savf,this.ewt),p=1e3*Math.abs(this.h)*this.ETA*this.n*c,0==p&&(p=1),m=1;m<=this.n;m++){for(x=i[m],u=Math.max(this.sqrteta*Math.abs(x),p/this.ewt[m]),i[m]+=u,c=-d/u,s(this.tn,i,this.acor,a),l=1;l<=this.n;l++)this.wm[l][m]=(this.acor[l]-this.savf[l])*c;i[m]=x}this.nfe+=this.n}else{if(3==this.miter)return;if(4==this.miter)throw"Error in prja: We do not support miter=4";if(5==this.miter)throw"Error in prja: We do not currently support miter=5"}if(this.pdnorm=function(t,i,s){let h,r,e,n,o;for(e=0,h=1;h<=t;h++){for(n=0,o=i[h],r=1;r<=t;r++)n+=Math.abs(o[r])/s[r];e=Math.max(e,n*s[h])}return e}(this.n,this.wm,this.ewt)/Math.abs(d),this.miter<3){for(l=1;l<=this.n;l++)this.wm[l][l]+=1;f=function(t,i,s,n){let o,a,l,f,m;if(n=0,f=i-1,f>=1)for(o=1;o<=f;o++)if(m=r(i-o+1,t[o],o-1,1)+o-1,s[o]=m,0!=t[o][m])for(m!=o&&(l=t[o][m],t[o][m]=t[o][o],t[o][o]=l),l=-1/t[o][o],e(i-o,l,t[o],o,1),a=o+1;a<=i;a++)l=t[a][m],m!=o&&(t[a][m]=t[a][o],t[a][o]=l),h(i-o,l,t[o],o,1,t[a],o,1);else n=o;return s[i]=i,0==t[i][i]&&(n=i),n}(this.wm,this.n,this.ipvt,f)}else{for(l=1;l<=this.n;l++)this.wm[void 0][l]+=1;f=function(t,i,s,n,o,a,l){let f,m,c,d,u,p,x,y,M,b,w,g,k,q,A;if(k=n+o+1,l=0,x=o+2,y=Math.min(s,k)-1,y>=x)for(p=x;p<=y;p++)for(c=k+1-p,m=c;m<=n;m++)t[m][p]=0;if(p=y,u=0,A=s-1,A>=1)for(M=1;M<=A;M++){if(b=M+1,p+=1,p<=s&&n>=1)for(m=1;m<=n;m++)t[m][p]=0;if(g=Math.min(n,s-M),w=r(g+1,t[M],k-1,1)+k-1,a[M]=w+M-k,0!=t[w][M]){if(w!=k&&(f=t[w][M],t[w][M]=t[k][M],t[k][M]=f),f=-1/t[k][M],e(g,f,t[M],k,1),u=Math.min(Math.max(u,o+a[M]),s),q=k,u>=b)for(d=b;d<=u;d++)w-=1,q-=1,f=t[d][w],w!=q&&(t[d][w]=t[d][q],t[d][q]=f),h(g,f,t[M],k,1,t[d],q,1)}else l=M}return a[s]=s,0==t[s][k]&&(l=s),l}(this.wm,0,this.n,this.ml,this.mu,this.ipvt,f)}0!=f&&(this.ierpj=1)}correction(t,i,s,h,r,e,o,a,l,f,m,c,d){let u,p,x,y;for(m=0,h=0,x=0,e=0,this.yp1=this.yh[1],u=1;u<=this.n;u++)i[u]=this.yp1[u];for(s(this.tn,i,this.savf,d),this.nfe++;;){if(0==m){if(this.ipup>0&&(this.prja(t,i,s,c,d),this.ipup=0,this.rc=1,this.nslp=this.nst,this.crate=.7,0!=this.ierpj))return[f,l,h]=this.corfailure(a,f,l,h),[h,e,o,a,l,f,m];for(u=1;u<=this.n;u++)this.acor[u]=0}if(0==this.miter){for(this.yp1=this.yh[2],u=1;u<=this.n;u++)this.savf[u]=this.h*this.savf[u]-this.yp1[u],i[u]=this.savf[u]-this.acor[u];for(e=n(this.n,i,this.ewt),this.yp1=this.yh[1],u=1;u<=this.n;u++)i[u]=this.yp1[u]+this.el[1]*this.savf[u],this.acor[u]=this.savf[u]}else{for(this.yp1=this.yh[2],u=1;u<=this.n;u++)i[u]=this.h*this.savf[u]-(this.yp1[u]+this.acor[u]);for(this.solsy(i),e=n(this.n,i,this.ewt),this.yp1=this.yh[1],u=1;u<=this.n;u++)this.acor[u]+=i[u],i[u]=this.yp1[u]+this.el[1]*this.acor[u]}if(e<=100*r*this.ETA)break;if((0!=m||1!=this.meth)&&(0!=m&&(p=1024,e<=1024*o&&(p=e/o),x=Math.max(x,p),this.crate=Math.max(.2*this.crate,p)),y=e*Math.min(1,1.5*this.crate)/(this.tesco[this.nq][2]*this.conit),y<=1)){this.pdest=Math.max(this.pdest,x/Math.abs(this.h*this.el[1])),0!=this.pdest&&(this.pdlast=this.pdest);break}if(++m==this.maxcor||m>=2&&e>2*o){if(0==this.miter||1==this.jcur)return[f,l,h]=this.corfailure(a,f,l,h),[h,e,o,a,l,f,m];for(this.ipup=this.miter,m=0,x=0,e=0,this.yp1=this.yh[1],u=1;u<=this.n;u++)i[u]=this.yp1[u];s(this.tn,i,this.savf,d),this.nfe++}else o=e,s(this.tn,i,this.savf,d),this.nfe++}return[h,e,o,a,l,f,m]}corfailure(t,i,s,h){let r,e,n;for(s++,this.rmax=2,this.tn=t,r=this.nq;r>=1;r--)for(e=r;e<=this.nq;e++)for(this.yp1=this.yh[e],this.yp2=this.yh[e+1],n=1;n<=this.n;n++)this.yp1[n]-=this.yp2[n];return Math.abs(this.h)<=1.00001*this.hmin||s==this.mxncf?[i,s,h=2]:(h=1,i=.25,this.ipup=this.miter,[i,s,h])}solsy(t){if(this.iersl=0,1==this.miter||2==this.miter)!function(t,i,r,e,n){let o,a,l,f,m;if(o=i-1,0!=n){if(o>=1)for(a=1;a<=o;a++)f=r[a],l=e[f],f!=a&&(e[f]=e[a],e[a]=l),h(i-a,l,t[a],a,1,e,a,1);for(m=1;m<=i;m++)a=i+1-m,e[a]=e[a]/t[a][a],l=-e[a],h(a-1,l,t[a],0,1,e,0,1)}else{for(a=1;a<=i;a++)l=s(a-1,t[a],0,1,e,0,1),e[a]=(e[a]-l)/t[a][a];if(o>=1)for(m=1;m<=o;m++)a=i-m,e[a]=e[a]+s(i-a,t[a],a,1,e,a,1),f=r[a],f!=a&&(l=e[f],e[f]=e[a],e[a]=l)}}(this.wm,this.n,this.ipvt,t,0);else{if(3==this.miter)throw"solsy with miter = "+this.miter;if(4==this.miter||5==this.miter){this.ml,this.mu;!function(t,i,r,e,n,o,a,l){let f,m,c,d,u,p,x,y=n+e+1,M=r-1;if(0==l){if(0!=e&&M>=1)for(m=1;m<=M;m++)x=Math.min(e,r-m),d=o[m],f=a[d],d!=m&&(a[d]=a[m],a[m]=f),h(x,f,t[m],y,1,a,m,1);for(c=1;c<=r;c++)m=r+1-c,a[m]=a[m]/t[y][m],x=Math.min(m,y)-1,u=y-x,p=m-x,f=-a[m],h(x,f,t[m],u-1,1,a,p-1,1)}else{for(m=1;m<=r;m++)x=Math.min(m,y)-1,u=y-x,p=m-x,f=s(x,t[m],u-1,1,a,p-1,1),a[m]=(a[m]-f)/t[y][m];if(0!=e&&M>=1)for(c=1;c<=M;c++)m=r-c,x=Math.min(e,r-m),a[m]=a[m]+s(x,t[m],y,1,a,m,1),d=o[m],d!=m&&(f=a[d],a[d]=a[m],a[m]=f)}}(this.wm,0,this.n,this.ml,this.mu,this.ipvt,t,0)}}}methodswitch(t,i,s,h){let r,e,o,a,l,f,m,c,d,u,p,x,y,M,b;if(1==this.meth){if(this.nq>5)return[s,h];if(t<=100*i*this.ETA||0==this.pdest){if(0==this.irflag)return[s,h];c=2,f=Math.min(this.nq,this.mxords)}else if(b=1/this.l,m=1/(1.2*Math.pow(t,b)+12e-7),d=2*m,(s=this.pdlast*Math.abs(this.h))*m>1e-5&&(d=this.sm1[this.nq]/s),m=Math.min(m,d),this.nq>this.mxords?(f=this.mxords,o=this.mxords+1,u=1/o,a=o+1,p=n(this.n,this.yh[a],this.ewt)/this.cm2[this.mxords],c=1/(1.2*Math.pow(p,u)+12e-7)):(p=t*(this.cm1[this.nq]/this.cm2[this.nq]),c=1/(1.2*Math.pow(p,b)+12e-7),f=this.nq),c<this.ratio*m)return[s,h];return h=c,this.icount=20,this.meth=2,this.miter=this.jtyp,this.pdlast=0,this.nq=f,this.l=this.nq+1,[s,h]}return b=1/this.l,this.mxordn<this.nq?(l=this.mxordn,r=this.mxordn+1,x=1/r,e=r+1,y=n(this.n,this.yh[e],this.ewt)/this.cm1[this.mxordn],m=1/(1.2*Math.pow(y,x)+12e-7)):(y=t*(this.cm2[this.nq]/this.cm1[this.nq]),m=1/(1.2*Math.pow(y,b)+12e-7),l=this.nq,x=b),d=2*m,(s=this.pdnorm*Math.abs(this.h))*m>1e-5&&(d=this.sm1[l]/s),m=Math.min(m,d),c=1/(1.2*Math.pow(t,b)+12e-7),m*this.ratio<5*c?[s,h]:(M=Math.max(.001,m),y*=Math.pow(M,x),y<=1e3*this.ETA*i||(h=m,this.icount=20,this.meth=1,this.miter=0,this.pdlast=0,this.nq=l,this.l=this.nq+1),[s,h])}endstoda(){let t,i;for(t=1/this.tesco[this.nqu][2],i=1;i<=this.n;i++)this.acor[i]*=t;this.hold=this.h,this.jstart=1}orderswitch(t,i,s,h,r){let e,o,a,l,f,m,c,d;if(r=0,a=1/this.l,f=1/(1.2*Math.pow(i,a)+12e-7),l=0,1!=this.nq&&(m=n(this.n,this.yh[this.l],this.ewt)/this.tesco[this.nq][1],c=1/this.nq,l=1/(1.3*Math.pow(m,c)+13e-7)),1==this.meth&&(s=Math.max(Math.abs(this.h)*this.pdlast,1e-6),this.l<this.lmax&&(t=Math.min(t,this.sm1[this.l]/s)),f=Math.min(f,this.sm1[this.nq]/s),this.nq>1&&(l=Math.min(l,this.sm1[this.nq-1]/s)),this.pdest=0),f>=t)f>=l?(e=this.nq,h=f):(e=this.nq-1,h=l,this.kflag<0&&h>1&&(h=1));else{if(!(t<=l)){if((h=t)>=1.1){for(d=this.el[this.l]/this.l,this.nq=this.l,this.l=this.nq+1,this.yp1=this.yh[this.l],o=1;o<=this.n;o++)this.yp1[o]=this.acor[o]*d;return[t,s,h,r=2]}return this.ialth=3,[t,s,h,r]}e=this.nq-1,h=l,this.kflag<0&&h>1&&(h=1)}if(1==this.meth){if(h*s*1.00001<this.sm1[e]&&0==this.kflag&&h<1.1)return this.ialth=3,[t,s,h,r]}else if(0==this.kflag&&h<1.1)return this.ialth=3,[t,s,h,r];return this.kflag<=-2&&(h=Math.min(h,.2)),e==this.nq?[t,s,h,r=1]:(this.nq=e,this.l=this.nq+1,[t,s,h,r=2])}resetcoeff(){let t,i;for(i=this.elco[this.nq],t=1;t<=this.l;t++)this.el[t]=i[t];this.rc=this.rc*this.el[1]/this.el0,this.el0=this.el[1],this.conit=.5/(this.nq+2)}}function l(t,i){for(let s=1;s<t.length;s++)i[s]=t[s]}t.LSODA=a,t.LSODAR=class extends a{lsodar(t,s,h,r,e,o,a,l,f,m,c,d,u,p,x,y,M,b,w,g,k,q,A,$,v,j,E,T){let z,O,D,L,S,W,_,P,R,B,C,F,G,H,I,J,K,N,Q,U,V,X,Y;if(m<1||m>3)return console.error("[lsodar] illegal istate = %d\n",m),[r,this.terminate(m)];if(f<1||f>5)return console.error("[lsodar] illegal itask = %d\n",f),[r,this.terminate(m)];if(0==this.init&&(2==m||3==m))return console.error("[lsodar] istate > 1 but lsoda not initialized\n"),[r,this.terminate(m)];if(1==m&&(this.init=0,e==r))return this.ntrep++,this.ntrep<5||console.error("[lsodar] repeated calls with istate = 1 and tout = t. run aborted.. apparent infinite loop\n"),[r,m];if(1==m||3==m){if(this.ntrep=0,s<=0)return console.error(`[lsodar] neq = ${s} is less than 1`),[r,this.terminate(m)];if(3==m&&s>this.n)return console.error("[lsodar] istate = 3 and neq increased"),[r,this.terminate(m)];if(this.n=s,o<1||o>4)return console.error(`[lsodar] itol = ${o} illegal`),[r,this.terminate(m)];if(c<0||c>1)return console.error(`[lsodar] iopt = ${c} illegal`),[r,this.terminate(m)];if(3==u||u<1||u>5)return console.error(`[lsodar] jt = ${u} illegal`),[r,this.terminate(m)];if(this.jtyp=u,u>2){if(this.ml=p,this.mu=x,this.ml<0||this.ml>=this.n)return console.error(`[lsodar] ml = ${this.ml} not between 1 and neq.`),[r,this.terminate(m)];if(this.mu<0||this.mu>=this.n)return console.error(`[lsodar] mu = ${this.mu} not between 1 and neq.`),[r,this.terminate(m)]}if(j<0)return console.error(`[lsodar] ng = ${j} is less than 0`),[r,this.terminate(m)];if(3==m&&0==this.irfnd&&j!=this.ngc)return console.error(`[lsodar] ng changed (from ${this.ngc} to ${j}) illegally.`),console.error("        i.e not immediately after a root was found"),[r,this.terminate(m)];if(this.ngc=j,0==c)this.ixpr=0,this.mxstep=500,this.mxhnil=10,this.hmxi=0,this.hmin=0,1==m&&(P=0,this.mxordn=this.mord[1],this.mxords=this.mord[2]);else{if(this.ixpr=y,this.ixpr<0||this.ixpr>1)return console.error(`[lsodar] ixpr = ${this.ixpr} is illegal`),[r,this.terminate(m)];if(this.mxstep=M,this.mxstep<0)return console.error("[lsodar] mxstep < 0"),[r,this.terminate(m)];if(0==this.mxstep&&(this.mxstep=500),this.mxhnil=b,this.mxhnil<0)return console.error("[lsodar] mxhnil < 0"),[r,this.terminate(m)];if(0==this.mxhnil&&(this.mxhnil=10),1==m){if(P=q,this.mxordn=w,this.mxordn<0)return console.error(`[lsodar] mxordn = ${this.mxordn} is less than 0`),[r,this.terminate(m)];if(0==this.mxordn&&(this.mxordn=100),this.mxordn=Math.min(this.mxordn,this.mord[1]),this.mxords=g,this.mxords<0)return console.error(`[lsodar] mxords = ${this.mxords} is less than 0`),[r,this.terminate(m)];if(0==this.mxords&&(this.mxords=100),this.mxords=Math.min(this.mxords,this.mord[2]),(e-r)*P<0)return console.error(`[lsodar] tout = ${e} behind t = ${r}. integration direction is given by ${P}`),[r,this.terminate(m)]}if(R=A,R<0)return console.error("[lsodar] hmax < 0."),[r,this.terminate(m)];if(this.hmxi=0,R>0&&(this.hmxi=1/R),this.hmin=$,this.hmin<0)return console.error("[lsodar] hmin < 0."),[r,this.terminate(m)]}}if(1==m){for(this.meth=1,this.nyh=this.n,D=1+Math.max(this.mxordn,this.mxords),this.yh=new Array(1+D),z=1;z<=D;z++)this.yh[z]=new Array(1+this.nyh);for(this.wm=new Array(1+this.nyh),z=1;z<=this.nyh;z++)this.wm[z]=new Array(1+this.nyh);this.ewt=new Array(1+this.nyh),this.savf=new Array(1+this.nyh),this.acor=new Array(1+this.nyh),this.ipvt=new Array(1+this.nyh),this.g0=new Array(1+j),this.g1=new Array(1+j),this.gx=new Array(1+j)}if(1==m||3==m)for(F=a[1],S=l[1],z=1;z<=this.n;z++){if(o>=3&&(F=a[z]),2!=o&&4!=o||(S=l[z]),F<0)return console.error(`[lsodar] rtol = ${F} is less than 0.`),[r,this.terminate(m)];if(S<0)return console.error(`[lsodar] atol = ${S} is less than 0.`),[r,this.terminate(m)]}if(3==m&&(this.jstart=-1),1==m){if(this.tn=r,this.tsw=r,this.maxord=this.mxordn,4==f||5==f){if(G=k,(G-e)*(e-r)<0)return console.error("[lsodar] itask = 4 or 5 and tcrit behind tout\n"),[r,this.terminate(m)];0!=P&&(r+P-G)*P>0&&(P=G-r)}for(this.jstart=0,this.nhnil=0,this.nst=0,this.nje=0,this.nslast=0,this.hu=0,this.nqu=0,this.mused=0,this.miter=0,this.ccmax=.3,this.maxcor=3,this.msbp=20,this.mxncf=10,t(r,h,this.yh[2],T),this.nfe=1,this.yp1=this.yh[1],z=1;z<=this.n;z++)this.yp1[z]=h[z];for(this.nq=1,this.h=1,i(this.n,o,a,l,h,this.ewt),z=1;z<=this.n;z++){if(this.ewt[z]<=0)return console.error(`[lsodar] ewt[${z}] = ${this.ewt[z]} <= 0.`),[r=this.terminate2(h,r),m];this.ewt[z]=1/this.ewt[z]}if(0==P){if(H=Math.abs(e-r),V=Math.max(Math.abs(r),Math.abs(e)),H<2*this.ETA*V)return console.error(`[lsodar] tout: ${e} too close to t: ${r} to start integration`),[r,this.terminate(m)];if(J=a[1],o>2)for(z=2;z<=this.n;z++)J=Math.max(J,a[z]);if(J<=0)for(S=l[1],z=1;z<=this.n;z++)2!=o&&4!=o||(S=l[z]),W=Math.abs(h[z]),0!=W&&(J=Math.max(J,S/W));J=Math.max(J,100*this.ETA),J=Math.min(J,.001),U=n(this.n,this.yh[2],this.ewt),U=1/(J*V*V)+J*U*U,P=1/Math.sqrt(U),P=Math.min(P,H),P*=e-r>=0?1:-1}for(C=Math.abs(P)*this.hmxi,C>1&&(P/=C),this.h=P,this.yp1=this.yh[2],z=1;z<=this.n;z++)this.yp1[z]*=P;if(this.irfnd=0,this.toutc=e,0!=this.ngc&&(Y=this.rchek(1,v,s,h,this.yh,this.nyh,this.g0,this.g1,this.gx,E,Y,T),0!=Y))return console.error("[lsodar] one or more components of g has a root too near to the initial point: "+r),[r,this.terminate(m)]}if(2==m||3==m){if(this.nslast=this.nst,X=this.irfnd,0!=this.ngc){if(1!=f&&4!=f||(this.toutc=e),Y=this.rchek(2,v,s,h,this.yh,this.nyh,this.g0,this.g1,this.gx,E,Y,T),1==Y)return this.irfnd=1,m=3,[r=this.t0,m];if(this.irfnd=0,1==X&&this.tlast!=this.tn&&2==f)return this.successreturn(h,r,f,L,G,m)}switch(f){case 1:if((this.tn-e)*this.h>=0)return O=this.intdy(e,0,h,O),0!=O?(console.error("[lsodar] trouble from intdy, itask = %d, tout = %g\n",f,e),[r,this.terminate(m)]):(r=e,m=2,this.illin=0,this.tlast=r,[r,m]);break;case 2:break;case 3:if(N=this.tn-this.hu*(1+100*this.ETA),(N-e)*this.h>0)return console.error("[lsodar] itask = ${itask} and tout behind tcur - hu"),[r,this.terminate(m)];if((this.tn-e)*this.h<0)break;return this.successreturn(h,r,f,L,G,m);case 4:if(G=k,(this.tn-G)*this.h>0)return console.error("[lsodar] itask = 4 or 5 and tcrit behind tcur\n"),[r,this.terminate(m)];if((G-e)*this.h<0)return console.error("[lsodar] itask = 4 or 5 and tcrit behind tout\n"),[r,this.terminate(m)];if((this.tn-e)*this.h>=0)return O=this.intdy(e,0,h,O),0!=O?(console.error(`[lsodar] trouble from intdy, itask = ${f}, tout = ${e}`),[r,this.terminate(m)]):(r=e,m=2,this.illin=0,this.tlast=r,[r,m]);case 5:if(5==f&&(G=k,(this.tn-G)*this.h>0))return console.error("[lsodar] itask = 4 or 5 and tcrit behind tcur\n"),[r,this.terminate(m)];if(B=Math.abs(this.tn)+Math.abs(this.h),L=Math.abs(this.tn-G)<=100*this.ETA*B,L)return r=G,this.successreturn(h,r,f,L,G,m);if(1==X&&this.tlast!=this.tn&&5==f)return this.successreturn(h,r,f,L,G,m);if(I=this.tn+this.h*(1+4*this.ETA),(I-G)*this.h<=0)break;this.h=(G-this.tn)*(1-4*this.ETA),2==m&&(this.jstart=-2)}}for(;;){if(1!=m||0!=this.nst){if(this.nst-this.nslast>=this.mxstep)return console.error("[lsodar] %d steps taken before reaching tout\n",this.mxstep),m=-1,[r=this.terminate2(h,r),m];for(i(this.n,o,a,l,this.yh[1],this.ewt),z=1;z<=this.n;z++){if(this.ewt[z]<=0)return console.error("[lsodar] ewt[%d] = %g <= 0.\n",z,this.ewt[z]),m=-6,[r=this.terminate2(h,r),m];this.ewt[z]=1/this.ewt[z]}}if(K=this.ETA*n(this.n,this.yh[1],this.ewt),K>.01)return K*=200,0==this.nst?(console.error("lsoda -- at start of problem, too much accuracy\n"),console.error("         requested for precision of machine,\n"),console.error(`         suggested scaling factor = ${K}\n`),[r,this.terminate(m)]):(console.error(`lsoda -- at t = ${r}, too much accuracy requested\n`),console.error("         for precision of machine, suggested\n"),console.error(`         scaling factor = ${K}\n`),m=-2,[r=this.terminate2(h,r),m]);if(this.tn+this.h==this.tn&&(this.nhnil++,this.nhnil<=this.mxhnil&&(console.error("lsoda -- warning..internal t = %g and h = %g are\n",this.tn,this.h),console.error("         such that in the machine, t + h = t on the next step\n"),console.error("         solver will continue anyway.\n"),this.nhnil==this.mxhnil&&(console.error("lsoda -- above warning has been issued %d times,\n",this.nhnil),console.error("         it will not be issued again for this problem\n")))),this.stoda(s,h,t,d,T),0==this.kflag){if(this.init=1,this.meth!=this.mused&&(this.tsw=this.tn,this.maxord=this.mxordn,2==this.meth&&(this.maxord=this.mxords),this.jstart=-1,this.ixpr&&(2==this.meth&&console.error("[lsodar] a switch to the stiff method has occurred "),1==this.meth&&console.error("[lsodar] a switch to the nonstiff method has occurred"),console.error("at t = %g, tentative step size h = %g, step nst = %d\n",this.tn,this.h,this.nst))),0!=this.ngc&&(Y=this.rchek(3,v,s,h,this.yh,this.nyh,this.g0,this.g1,this.gx,E,Y,T),1==Y))return this.irfnd=1,m=3,r=this.t0,this.tlast=r,[r,m];if(1==f){if((this.tn-e)*this.h<0)continue;return O=this.intdy(e,0,h,O),r=e,m=2,this.illin=0,this.tlast=r,[r,m]}if(2==f)return this.successreturn(h,r,f,L,G,m);if(3==f){if((this.tn-e)*this.h>=0)return this.successreturn(h,r,f,L,G,m);continue}if(4==f){if((this.tn-e)*this.h>=0)return O=this.intdy(e,0,h,O),r=e,m=2,this.illin=0,this.tlast=r,[r,m];if(B=Math.abs(this.tn)+Math.abs(this.h),L=Math.abs(this.tn-G)<=100*this.ETA*B,L)return this.successreturn(h,r,f,L,G,m);if(I=this.tn+this.h*(1+4*this.ETA),(I-G)*this.h<=0)continue;this.h=(G-this.tn)*(1-4*this.ETA),this.jstart=-2;continue}if(5==f)return B=Math.abs(this.tn)+Math.abs(this.h),L=Math.abs(this.tn-G)<=100*this.ETA*B,this.successreturn(h,r,f,L,G,m)}if(-1==this.kflag||-2==this.kflag){for(console.error(`lsoda -- at t = ${this.tn} and step size h = ${this.h}, the`),-1==this.kflag&&(console.error("         error test failed repeatedly or"),console.error("         with abs(h) = hmin"),m=-4),-2==this.kflag&&(console.error("         corrector convergence failed repeatedly or\n"),console.error("         with abs(h) = hmin\n"),m=-5),_=0,this.imxer=1,z=1;z<=this.n;z++)Q=Math.abs(this.acor[z])*this.ewt[z],_<Q&&(_=Q,this.imxer=z);return[r=this.terminate2(h,r),m]}}return[r,m]}successreturn(t,i,s,h,r,e){this.yp1=this.yh[1];for(let i=1;i<=this.n;i++)t[i]=this.yp1[i];return i=this.tn,4!=s&&5!=s||h&&(i=r),2,this.illin=0,this.tlast=i,[i,2]}rchek(t,i,s,h,r,e,n,o,a,f,m,c){var d,u,p,x,y,M,b,w;m=0;for(let t=1;t<=this.ngc;t++)f[t]=0;switch(p=(Math.abs(this.tn)+Math.abs(this.h))*this.ETA*100,t){case 1:this.t0=this.tn,i(this.t0,h,n,c),this.nge=1,w=!1;for(let t=1;t<=this.ngc;t++)Math.abs(n[t])<=0&&(w=!0);if(w){x=p*(this.h>=0?1:-1),this.t0=this.t0+x,y=x/this.h;for(let t=1;t<=this.n;t++)h[t]=h[t]+y*this.yh[2][t];i(this.t0,h,n,c),this.nge=this.nge+1,w=!1;for(let t=1;t<=this.ngc;t++)Math.abs(n[t])<=0&&(w=!0);w&&(m=-1)}return m;case 2:if(0!=this.irfnd){b=this.intdy(this.t0,0,h,b),i(this.t0,h,n,c),this.nge=this.nge+1,w=!1;for(let t=1;t<=this.ngc;t++)Math.abs(n[t])<=0&&(w=!0);if(w){if(x=p*(this.h>=0?1:-1),this.t0=this.t0+x,(this.t0-this.tn)*this.h<0)b=this.intdy(this.t0,0,h,b);else{y=x/this.h;for(let t=1;t<=this.n;t++)h[t]=h[t]+y*this.yh[2][t]}i(this.t0,h,n,c),this.nge=this.nge+1,w=!1;for(let t=1;t<=this.ngc&&!(Math.abs(n[t])>0);t++)f[t]=1,w=!0;if(w)return m=1}}if(this.tn==this.tlast)return m;case 3:if(2!=this.itaskc&&3!=this.itaskc&&5!=this.itaskc&&(this.toutc-this.tn)*this.h<0){if(((d=this.toutc)-this.t0)*this.h<=0)return m;b=this.intdy(d,0,h,b)}else{d=this.tn;for(let t=1;t<=this.n;t++)h[t]=r[1][t]}for(i(d,h,o,c),this.nge=this.nge+1,M=0;[M,this.t0,d,u]=this.roots(this.ngc,p,M,this.t0,d,n,o,a,u,f),!(M>1);)b=this.intdy(u,0,h,b),i(u,h,a,c),this.nge=this.nge+1;return this.t0=u,l(a,n),4==M?m:(b=this.intdy(u,0,h,b),m=1)}return m}roots(t,i,s,h,r,e,n,o,a,f){var m,c,d,u,p,x,y;if(1==s){x=this.imax,this.imax=0,u=0,m=!1;for(let i=1;i<=t;i++)if(Math.abs(o[i])>0){if(Math.sign(e[i])==Math.sign(o[i]))continue;if((p=Math.abs(o[i]/(o[i]-e[i])))<=u)continue;u=p,this.imax=i}else m=!0;this.imax>0?d=!0:(d=!1,this.imax=x),y=this.last,d?(r=this.x2,l(o,n),this.last=1,c=!1):m?(r=this.x2,l(o,n),c=!0):(l(o,e),h=this.x2,this.last=0,c=!1),Math.abs(r-h)<=i&&(c=!0)}else{this.imax=0,u=0,m=!1;for(let i=1;i<=t;i++)if(Math.abs(n[i])>0){if(Math.sign(e[i])==Math.sign(n[i]))continue;if((p=Math.abs(n[i]/(n[i]-e[i])))<=u)continue;u=p,this.imax=i}else m=!0;if(!(d=this.imax>0)){if(m){a=r,l(n,o);for(let i=1;i<=t;i++)f[i]=0,Math.abs(n[i])<=0&&(f[i]=1);return[s=3,h,r,a]}return l(n,o),[s=4,h,r,a=r]}c=!1,y=0,this.last=1}for(;;){if(c){s=2,a=r,l(n,o);for(let i=1;i<=t;i++)f[i]=0,Math.abs(n[i])>0?Math.sign(e[i])!=Math.sign(n[i])&&(f[i]=1):f[i]=1;return[s,h,r,a]}return y==this.last?0==this.last?this.alpha=2*this.alpha:this.alpha=.5*this.alpha:this.alpha=1,this.x2=r-(r-h)*n[this.imax]/(n[this.imax]-this.alpha*e[this.imax]),Math.abs(this.x2-h)<i&&Math.abs(r-h)>10*i&&(this.x2=h+.1*(r-h)),[s=1,h,r,a=this.x2]}}},Object.defineProperty(t,"__esModule",{value:!0})}));
